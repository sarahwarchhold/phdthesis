%% CAPTIONS
\usepackage{caption}
\DeclareCaptionStyle{italic}[justification=centering]
 {labelfont={bf},textfont={it},labelsep=colon}
\captionsetup[figure]{style=italic,format=hang,singlelinecheck=true}
\captionsetup[table]{style=italic,format=hang,singlelinecheck=true}

%% FONT
\usepackage{bera}
\usepackage[charter]{mathdesign}
\usepackage[scale=0.9]{sourcecodepro}
\usepackage[lf,t]{FiraSans}
\usepackage{fontawesome}
%% IPA symbols
\usepackage{tipa}
%% underlining of title according to Uni Konstanz template
\usepackage{xcolor,soul}
\definecolor{seeblau}{HTML}{59C7EB}
\setulcolor{seeblau}
\setul{2pt}{2pt}% 1pt below contents

\usepackage[utf8]{inputenc}
%% HEADERS AND FOOTERS
% \usepackage{fancyhdr}
% \pagestyle{fancy}
% \rfoot{\Large\sffamily\raisebox{-0.1cm}{\textbf{\thepage}}}
% \makeatletter
% \lhead{\textsf{\expandafter{\@title}}}
% \makeatother
% \rhead{}
% \cfoot{}
% \setlength{\headheight}{15pt}
% \renewcommand{\headrulewidth}{0.4pt}
% \renewcommand{\footrulewidth}{0.4pt}
% \fancypagestyle{plain}{%
% \fancyhf{} % clear all header and footer fields
% \fancyfoot[C]{\sffamily\thepage} % except the center
% \renewcommand{\headrulewidth}{0pt}
% \renewcommand{\footrulewidth}{0pt}}
\usepackage{fancyhdr}
\usepackage{etoolbox}
\pagestyle{fancy}

% Clear all header and footer fields
\fancyhf{}

% Customizing the header for even and odd pages
\fancyhead[RO]{\textsf{\thepage}} % Page number on the right for odd pages
\fancyhead[LE]{\textsf{\thepage}} % Page number on the left for even pages
\fancyhead[LO]{\textsf{\nouppercase{\leftmark}}} % Chapter title on the left for odd pages
\fancyhead[RE]{\textsf{\nouppercase{\leftmark}}} % Chapter title on the right for even pages

% No footer customization needed since we are not displaying anything in the footer
\renewcommand{\footrulewidth}{0pt}

% Additional settings for plain pages (e.g., start of chapters)
\fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \fancyfoot[C]{\textsf{\thepage}} % Page number centered in the footer with same font and size as header
  \renewcommand{\headrulewidth}{0pt} % No header rule
  \renewcommand{\footrulewidth}{0pt} % No footer rule
}

\setlength{\headheight}{15pt}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

% Ensure the plain style is applied to chapter starting pages and switch to fancy after
\makeatletter
\preto\chapter{\clearpage\thispagestyle{plain}}
\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{plain}\pagestyle{fancy}}{}{}
\makeatother


%% MATHS
\usepackage{bm,amsmath}
\allowdisplaybreaks

%% GRAPHICS
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.8}
\graphicspath{{figures/}}

%% SECTION TITLES
\usepackage[compact,sf,bf]{titlesec}
\titleformat*{\section}{\Large\sf\bfseries}
\titleformat*{\subsection}{\large\sf\bfseries}
\titleformat*{\subsubsection}{\sf\bfseries}
\titlespacing{\section}{0pt}{2ex}{.5ex}
\titlespacing{\subsection}{0pt}{1.5ex}{0ex}
\titlespacing{\subsubsection}{0pt}{.5ex}{0ex}

%% TABLES
\usepackage{booktabs,tabu}

%% BIBLIOGRAPHY.

\makeatletter
\@ifpackageloaded{biblatex}{
\ExecuteBibliographyOptions{bibencoding=utf8,minnames=1,maxnames=3, maxbibnames=99,dashed=false,terseinits=true,giveninits=true,uniquename=false,uniquelist=false,doi=false, isbn=false,url=true,sortcites=false}
\DeclareFieldFormat{url}{\texttt{\url{#1}}}
\DeclareFieldFormat[article]{pages}{#1}
\DeclareFieldFormat[inproceedings]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[incollection]{pages}{\lowercase{pp.}#1}
\DeclareFieldFormat[article]{volume}{\mkbibbold{#1}}
\DeclareFieldFormat[article]{number}{\mkbibparens{#1}}
\DeclareFieldFormat[article]{title}{\MakeCapital{#1}}
\DeclareFieldFormat[article]{url}{}
\DeclareFieldFormat[inproceedings]{title}{#1}
\DeclareFieldFormat{shorthandwidth}{#1}
\usepackage{xpatch}
\xpatchbibmacro{volume+number+eid}{\setunit*{\adddot}}{}{}{}
% Remove In: for an article.
\renewbibmacro{in:}{%
  \ifentrytype{article}{}{%
  \printtext{\bibstring{in}\intitlepunct}}}
\AtEveryBibitem{\clearfield{month}}
\AtEveryCitekey{\clearfield{month}}
\DeclareDelimFormat[cbx@textcite]{nameyeardelim}{\addspace}
\renewcommand*{\finalnamedelim}{\addspace\&\space}
}{}
\makeatother


\hypersetup{
     pdfcreator={Quarto -> pandoc -> LaTeX -> pdf}
}


%% PAGE BREAKING to avoid widows and orphans
\clubpenalty = 2000
\widowpenalty = 2000
\usepackage{microtype}
